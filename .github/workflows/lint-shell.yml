name: Lint Shell
on:
  workflow_dispatch:
  push:
    paths:
      - ".github/workflows/lint-shell.yml"
  pull_request:
    paths:
      - "**.sh"

jobs:
  shellcheck:
    # use pre-installed shellcheck
    # https://github.com/actions/virtual-environments/blob/main/images/linux/Ubuntu2004-Readme.md
    name: Lint by shellcheck
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Display shellcheck
        run: |
          shellcheck --version
      - name: Run shellcheck
        run: |
          set -x
          shellcheck ./**/*.sh

  shfmt:
    name: Lint by shfmt
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Pull shfmt
        run: |
          docker pull mvdan/shfmt
      - name: Display shfmt
        run: |
          docker run --rm -v "$(pwd)":/work -w /work \
          --security-opt=no-new-privileges --cap-drop all --network none \
          mvdan/shfmt --version
      - name: Run shfmt
        run: |
          set -x
          docker run --rm -v "$(pwd)":/work -w /work \
          --security-opt=no-new-privileges --cap-drop all --network none \
          mvdan/shfmt -i 2 -ci -bn -d ./**/*.sh
